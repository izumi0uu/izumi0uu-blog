---
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";

import footerImage from "@/assets/images/footer-default.png";

import Link from "@/components/Link.astro";
import FullWidth from "@/layouts/FullWidth.astro";
import { ROUTES } from "@/constants/routes";
import { CONFIG_CLIENT } from "@/config/client";

import { Logo } from "@/components/react/ui/Logo";

import { getLatestCommitInfo } from "@/libs/git";
import { shortDate } from "@/utils/data/datetime";
import { limitString, trimHttpProtocol } from "@/utils/data/strings";
import { cn } from "@/utils/ui/styles";
import * as m from "@/paraglide/messages";

const { SITE_URL, AUTHOR_LINKEDIN, AUTHOR_GITHUB, REPO_URL, AUTHOR_NAME } = CONFIG_CLIENT;
const domain = trimHttpProtocol(SITE_URL);
const messageLength = 15 as const;

const { time, fullHash, message } = getLatestCommitInfo();

const commitUrl = `${REPO_URL}/commit/${fullHash}`;
const shortDateStr = shortDate(new Date(time));
const trimmedMessage = limitString(message, messageLength);

const footerNavigation = {
  resources: [
    { name: m["components.footer.links.blog"](), href: ROUTES.BLOG, icon: "mdi:blog" },
    { name: m["components.footer.links.projects"](), href: ROUTES.PROJECTS, icon: "mdi:briefcase" },
    { name: m["components.footer.links.about"](), href: ROUTES.ABOUT, icon: "mdi:alien-outline" },
  ],
  quickInfo: [
    { name: m["components.footer.links.contact"](), href: ROUTES.CONTACT, icon: "mdi:contact" },
    { name: m["components.footer.links.rss_feed"](), href: ROUTES.API.FEED_RSS, icon: "mdi:rss" },
    { name: m["components.footer.links.sitemap"](), href: "/sitemap.xml", icon: "mdi:sitemap" },
  ],
  social: [
    { name: m["components.footer.links.github"](), href: AUTHOR_GITHUB, icon: "mdi:github" },
    { name: m["components.footer.links.linkedin"](), href: AUTHOR_LINKEDIN, icon: "mdi:linkedin" },
  ],
};
---

<footer
  class={cn("border-t border-outline bg-surface-container", "py-12 px-4 mt-auto")}
  role="contentinfo"
  aria-label="Footer"
>
  <div class="max-w-7xl mx-auto">
    <!-- Main Content Section -->
    <div class="grid grid-cols-1 md:grid-cols-12 gap-8 lg:gap-12">
      <!-- Brand Section -->
      <section class="md:col-span-5 lg:col-span-4" aria-labelledby="brand-heading">
        <div class="space-y-4">
          <!-- Brand Logo and Name -->
          <Link
            href="/"
            variant="link"
            class={cn(
              "inline-flex items-center gap-3",
              "text-content hover:text-primary transition-colors"
            )}
            aria-label={m["components.footer.back_to_top"]()}
          >
            <Logo />
            <span class="text-xl font-bold tracking-tight">
              {AUTHOR_NAME}
            </span>
          </Link>

          <!-- Brand Description -->
          <p class={cn("text-content leading-relaxed max-w-md", "text-sm")}>
            {m["components.footer.brand_description"]()}
          </p>

          <!-- Latest Commit Info -->
          <div class="flex items-center gap-2 text-xs text-content">
            <Icon name="mdi:github" class="h-4 w-4 fill-current" />
            <span class="font-medium">{m["components.footer.latest_commit"]()}:</span>
            <Link
              href={commitUrl}
              title={`${shortDateStr} - ${message}`}
              target="_blank"
              class="hover:text-primary transition-colors"
            >
              {trimmedMessage}
            </Link>
          </div>
        </div>
      </section>

      <!-- Navigation Section  -->
      <nav class="md:col-span-7 lg:col-span-8" aria-label="footer-navigation">
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-8">
          <!-- Resources Links -->
          <section aria-labelledby="resources-heading">
            <h3 id="resources-heading" class={cn("text-content font-semibold mb-4", "text-sm")}>
              {m["components.footer.sections.resources"]()}
            </h3>
            <ul class="space-y-3" role="list">
              {
                footerNavigation.resources.map((item) => (
                  <li>
                    <Link
                      href={item.href}
                      variant="underline"
                      class={cn(
                        "text-content hover:text-primary",
                        "transition-colors text-sm",
                        "inline-flex items-center gap-1"
                      )}
                    >
                      <Icon name={item.icon} class="h-6 w-6 fill-current" />
                      {item.name}
                    </Link>
                  </li>
                ))
              }
            </ul>
          </section>

          <!-- Quick Info Links -->
          <section aria-labelledby="info-heading">
            <h3 id="info-heading" class={cn("text-content font-semibold mb-4", "text-sm")}>
              {m["components.footer.sections.quick_info"]()}
            </h3>
            <ul class="space-y-3" role="list">
              {
                footerNavigation.quickInfo.map((item) => (
                  <li>
                    <Link
                      href={item.href}
                      variant="underline"
                      class={cn(
                        "text-content hover:text-primary",
                        "transition-colors text-sm",
                        "inline-flex items-center gap-1"
                      )}
                    >
                      <Icon name={item.icon} class="h-6 w-6 fill-current" />
                      {item.name}
                    </Link>
                  </li>
                ))
              }
            </ul>
          </section>

          <!-- Social Links -->
          <section aria-labelledby="social-heading">
            <h3 id="social-heading" class={cn("text-content font-semibold mb-4", "text-sm")}>
              {m["components.footer.sections.social"]()}
            </h3>
            <ul class="flex flex-wrap gap-3 lg:flex-col lg:space-y-3" role="list">
              {
                footerNavigation.social.map((item) => (
                  <li>
                    <Link
                      href={item.href}
                      variant="underline"
                      target="_blank"
                      rel="me noreferrer noopener"
                      class={cn(
                        "inline-flex items-center gap-2",
                        "text-content hover:text-primary",
                        "transition-colors text-sm"
                      )}
                      aria-label={m["components.footer.meta.follow_on"]({ platform: item.name })}
                    >
                      <Icon name={item.icon} class="h-6 w-6 fill-current" />
                      <span>{item.name}</span>
                    </Link>
                  </li>
                ))
              }
            </ul>
          </section>

          <!-- Footer Image -->
          <section
            aria-labelledby="footer-image"
            class="flex items-start justify-center lg:justify-start"
          >
            <Image src={footerImage} alt="Footer Image" class="w-16 h-16 object-cover" />
          </section>
        </div>
      </nav>
    </div>

    <!-- Copyright Section -->
    <section
      class={cn(
        "mt-12 pt-8 border-t border-outline-variant",
        "flex flex-col md:flex-row justify-between items-center gap-4"
      )}
      aria-label="copyright"
    >
      <p class={cn("text-content text-xs lg:text-sm", "text-center md:text-left")}>
        {
          m["components.footer.copyright_text"]({
            year: new Date().getFullYear().toString(),
            author: AUTHOR_NAME,
          })
        }
      </p>

      <!-- Additional Meta Info -->
      <div class={cn("text-content text-xs", "flex items-center gap-4")}>
        <span>{m["components.footer.meta.domain_label"]()}: {domain}</span>
        <span>â€¢</span>
        <span>{m["components.footer.meta.built_with"]()}</span>
      </div>
    </section>
  </div>
</footer>
