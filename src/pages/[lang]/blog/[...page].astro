---
import { getAllPostsWithReadingTime } from "@/modules/post/common";
import List from "@/layouts/List.astro";
import PostList from "@/components/blog/PostList.astro";
import { CONFIG_CLIENT } from "@/config/client";
import { getPageMetadata } from "@/utils/content/metadata";
import { pickPaginationPropsFromPage } from "@/utils/content/pagination";

import type { Post } from "@/types/post";
import type { GetStaticPathsOptions } from "astro";

// TODO: i18n
// [page].astro and getStaticPaths because of pagination
export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const posts: Post[] = await getAllPostsWithReadingTime();
  // must take entire config here, interesting
  const pageSize = CONFIG_CLIENT.PAGE_SIZE_POST_CARD;

  const pagination = paginate(posts, { pageSize });
  // additional page route for the first page route ,like /zh/blog/1/
  pagination.push({ params: { page: "1" }, props: pagination[0].props });
  return pagination;
}

// page from pagination
const { page } = Astro.props;
const { data: posts } = page;

const paginationProps = pickPaginationPropsFromPage(page);

const metadata = getPageMetadata("lists/blog");

const layoutProps = { metadata, paginationProps };
---

<List {...layoutProps}>
  <PostList posts={posts} />
</List>
