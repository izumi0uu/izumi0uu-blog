---
import { getAllPostsWithReadingTime } from "@/modules/post/common";
import { SUPPORTED_LOCALES } from "@/config/i18n";
import Base from "@/layouts/Base.astro";

export async function getStaticPaths() {
  const posts = await getAllPostsWithReadingTime();
  console.log(`生成动态路由，文章数量: ${posts.length}`);

  // 为每种语言创建路径
  const paths = posts.flatMap((post) =>
    SUPPORTED_LOCALES.map((lang) => {
      // 确保slug格式正确，移除可能的后缀
      const cleanSlug = post.slug.replace(/\.mdx$/, "");
      console.log(`为文章 ${cleanSlug} 创建 ${lang} 语言路由`);
      return {
        params: {
          lang,
          slug: cleanSlug,
        },
        props: { post, lang },
      };
    })
  );

  console.log(`总共生成 ${paths.length} 条路由`);
  return paths;
}

// 从props中获取文章数据
const { post } = Astro.props;
const { data, slug } = post;
const { title, description } = data;

// 基本元数据
const metadata = { title, description };
---

<Base {metadata}>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-4">{title}</h1>
    {description && <p class="text-lg mb-8">{description}</p>}

    <div class="prose max-w-none">
      <!-- 内容将在后续实现 -->
      <p>文章内容将在后续实现...</p>
    </div>
  </div>
</Base>
